<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring custom DNS and DNS forwarding :: Advanced Administration of Azure Red Hat OpenShift</title>
    <link rel="prev" href="configuring-log-forwarding.html">
    <link rel="next" href="../registry-integrations/registry-integrations.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Administration of Azure Red Hat OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="wurcbtest" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/azure-red-hat-openshift-architecture-and-overview.html">Azure Red Hat OpenShift Architecture and Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/aro-platform-capabilities.html">ARO platform capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/joint-engineering-operation-and-support-model.html">Joint engineering, operation, and support model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/managed-control-plane-and-infrastructure.html">Managed control plane and infrastructure</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../aro-cluster-provisioning/aro-cluster-provisioning.html">ARO Cluster Provisioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-an-azure-red-hat-openshift-cluster.html">Creating an Azure Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-a-private-azure-red-hat-openshift-cluster.html">Creating a private Azure Red Hat OpenShift cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="core-cluster-configuration.html">Core Cluster Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-additional-storage-classes.html">Configuring additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-node-autoscaling.html">Configuring node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-log-forwarding.html">Configuring log forwarding</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registry-integrations/registry-integrations.html">Registry Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-azure-container-registry-acr.html">Integrating with Azure Container Registry (ACR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-quay.html">Integrating with Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/using-the-internal-openshift-registry.html">Using the internal OpenShift registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-application-data-management/cluster-application-data-management.html">Cluster Application Data Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-application-data-management/backup-and-restore-of-cluster-applications-using-velero.html">Backup and restore of cluster applications using Velero</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/openshift-and-kubernetes-interfaces.html">OpenShift and Kubernetes Interfaces</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/navigating-the-openshift-web-console.html">Navigating the OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-kubernetes-command-line-interface-cli.html">Utilizing the Kubernetes Command-line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-openshift-command-line-interface-cli.html">Utilizing the OpenShift Command-line Interface (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-and-application-management.html">Troubleshooting and Application Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-containers-and-pods.html">Troubleshooting containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/managing-applications-using-the-kubernetes-workload-api.html">Managing applications using the Kubernetes Workload API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/kubernetes-networking-and-application-exposure.html">Kubernetes Networking and Application Exposure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/understanding-kubernetes-pod-and-service-networks.html">Understanding Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/scaling-and-exposing-applications-to-external-access.html">Scaling and exposing applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/externalizing-application-configurations.html">Externalizing application configurations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-security-policies/network-security-policies.html">Network Security Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/configuring-network-policies.html">Configuring network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/limiting-ingress-traffic.html">Limiting ingress traffic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gitops-for-cluster-administration/gitops-for-cluster-administration.html">GitOps for Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/implementing-openshift-gitops.html">Implementing OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/using-argocd-for-declarative-cluster-management.html">Using ArgoCD for declarative cluster management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../multi-cluster-management/multi-cluster-management.html">Multi-Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/overview-of-red-hat-advanced-cluster-management-rhacm.html">Overview of Red Hat Advanced Cluster Management (RHACM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/managing-kubernetes-clusters-with-rhacm.html">Managing Kubernetes clusters with RHACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../knowledge-share-and-discussions/knowledge-share-and-discussions.html">Knowledge Share and Discussions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-ad-with-openshift-oauth.html">Integrating Azure AD with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-key-vault-with-aro.html">Integrating Azure Key Vault with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/differentiating-availability-sets-vs-availability-zones.html">Differentiating Availability Sets vs. Availability Zones</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/understanding-azure-spot-instances.html">Understanding Azure Spot Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/exploring-hosted-control-planes.html">Exploring Hosted Control Planes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab/hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-an-azure-red-hat-openshift-cluster.html">Create an Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-additional-storage-classes.html">Configure additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-dedicated-machine-sets.html">Create dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-node-autoscaling.html">Configure node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-log-forwarding.html">Configure log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-a-private-azure-red-hat-openshift-cluster.html">Create a private Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-custom-dns-and-dns-forwarding.html">Configure custom DNS and DNS forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-registry-integrations-with-aro.html">Implement registry integrations with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/perform-backup-and-restore-of-a-cluster-application-with-velero.html">Perform backup and restore of a cluster application with Velero</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/troubleshoot-containers-and-pods.html">Troubleshoot containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-applications-using-the-kubernetes-workload-api.html">Manage applications using the Kubernetes Workload API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/explore-kubernetes-pod-and-service-networks.html">Explore Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/scale-and-expose-applications-to-external-access.html">Scale and expose applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/externalize-application-configurations.html">Externalize application configurations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-a-cluster-using-red-hat-advanced-cluster-management.html">Manage a cluster using Red Hat Advanced Cluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Administration of Azure Red Hat OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></li>
    <li><a href="core-cluster-configuration.html">Core Cluster Configuration</a></li>
    <li><a href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring custom DNS and DNS forwarding</h1>
<h1 id="_configuring_custom_dns_and_dns_forwarding_in_azure_red_hat_openshift" class="sect0"><a class="anchor" href="#_configuring_custom_dns_and_dns_forwarding_in_azure_red_hat_openshift"></a>Configuring Custom DNS and DNS Forwarding in Azure Red Hat OpenShift</h1>
<div class="paragraph">
<p>This module delves into configuring custom DNS servers for your Azure Red Hat OpenShift (ARO) cluster and understanding the implications of such a configuration. By the end of this module, you will understand how ARO nodes obtain DNS configurations, the process of switching to a custom DNS, and how to apply these changes to your cluster.</p>
</div>
<div class="sect1">
<h2 id="_understanding_aro_dns_configuration"><a class="anchor" href="#_understanding_aro_dns_configuration"></a>Understanding ARO DNS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, when an Azure Red Hat OpenShift cluster node powers on and joins the network, it utilizes DHCP to receive network configurations, including the IP address and the DNS server to use. This default setup ensures seamless resolution of internal Azure resources and OpenShift components.</p>
</div>
<div class="paragraph">
<p>The process flow for obtaining this configuration is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Node Boot-up</strong>: An ARO worker or master node starts.</p>
</li>
<li>
<p><strong>DHCP Request</strong>: The node sends a DHCP request to the virtual network.</p>
</li>
<li>
<p><strong>Configuration Assignment</strong>: DHCP assigns an IP address and the default DNS server (typically Azure-provided DNS) to the virtual machine.</p>
</li>
<li>
<p><strong>DNS Resolution</strong>: The node uses this DNS server for all its DNS queries, including resolving other virtual machines within the same virtual network and external services.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An important consideration when configuring your own custom DNS server is that you will lose the default configuration provided by Azure&#8217;s DNS server in the virtual network. This means that <strong>virtual machine names will no longer resolve through DNS on the network</strong> <a href="#references/context.adoc" class="xref unresolved">references/context.adoc</a>. Nodes will only be reachable via their IP address. This trade-off is crucial to understand before implementing a custom DNS setup.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_a_custom_dns_server"><a class="anchor" href="#_configuring_a_custom_dns_server"></a>Configuring a Custom DNS Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuring a custom DNS server for your ARO cluster involves two primary steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modifying the Virtual Network DNS Servers configuration setting.</p>
</li>
<li>
<p>Restarting the nodes in the cluster to apply the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While these steps can be performed via the command line, this documentation focuses on using the Azure portal web interface for clarity and ease of use.</p>
</div>
<div class="sect2">
<h3 id="_step_1_update_dns_configuration_in_the_virtual_network"><a class="anchor" href="#_step_1_update_dns_configuration_in_the_virtual_network"></a>Step 1: Update DNS Configuration in the Virtual Network</h3>
<div class="paragraph">
<p>The first step is to instruct your virtual network to use your custom DNS servers instead of the default Azure-provided DNS.</p>
</div>
<div class="paragraph">
<div class="title">Enter the IP addresses for your DNS servers. You can add multiple servers for redundancy.</div>
<p>+</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure your custom DNS servers are accessible from within the Azure virtual network and are capable of resolving both internal and external DNS requests as required by your OpenShift cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Click <strong>Save</strong> to apply the changes to the virtual network.</div>
<p>This action updates the DHCP settings for your virtual network, but existing nodes will not immediately pick up these changes. For the ARO nodes to start using the new DNS configuration, they must renew their DHCP leases, which typically happens upon a reboot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_reboot_aro_cluster_nodes_to_apply_changes"><a class="anchor" href="#_step_2_reboot_aro_cluster_nodes_to_apply_changes"></a>Step 2: Reboot ARO Cluster Nodes to Apply Changes</h3>
<div class="paragraph">
<p>After updating the virtual network&#8217;s DNS configuration, you must reboot the ARO cluster nodes (both worker and master) to ensure they pick up the new custom DNS server settings. This process involves deleting specific <code>MachineConfig</code> objects, which triggers a controlled reboot of the nodes managed by the Machine Config Operator.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The procedure for modifying a custom DNS on a cluster that already has custom DNS in place follows the same process. You would first update the virtual network DNS configuration and then proceed to reboot the nodes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_hands_on_activity_apply_custom_dns_configuration"><a class="anchor" href="#_hands_on_activity_apply_custom_dns_configuration"></a>Hands-on Activity: Apply Custom DNS Configuration</h4>
<div class="paragraph">
<p>In this hands-on activity, you will apply the custom DNS settings by rebooting the worker and master nodes of your ARO cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites:</div>
<ul>
<li>
<p>An active Azure Red Hat OpenShift cluster.</p>
</li>
<li>
<p><code>oc</code> CLI configured and logged in to your cluster with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>You have already updated the virtual network&#8217;s DNS servers in the Azure portal as described in Step 1.</p>
</li>
</ul>
</div>
<div class="olist loweralpha">
<div class="title">Reboot Worker Nodes:</div>
<ol class="loweralpha" type="a">
<li>
<p>Open a terminal and log in to your ARO cluster using the <code>oc</code> CLI.</p>
</li>
<li>
<p>To trigger a reboot of the worker nodes, you will delete the <code>MachineConfig</code> object associated with their reboot. This will cause the Machine Config Operator to regenerate the configuration and reboot the nodes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete machineconfig 25-machineconfig-worker-reboot</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">machineconfig.machineconfiguration.openshift.io "25-machineconfig-worker-reboot" deleted</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Wait for all worker nodes to reboot.</strong> You can monitor the status of the nodes using <code>oc get nodes</code> and observe their readiness state. This process can take some time as each node reboots and rejoins the cluster. Ensure all worker nodes return to a <code>Ready</code> state before proceeding.</p>
</li>
</ol>
</div>
<div class="olist loweralpha">
<div class="title">Reboot Master Nodes:</div>
<ol class="loweralpha" type="a">
<li>
<p>Once all worker nodes are back online and healthy, proceed to reboot the master nodes. This is a critical step, and it&#8217;s essential to ensure the cluster remains stable throughout the process.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete machineconfig 25-machineconfig-master-reboot</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">machineconfig.machineconfiguration.openshift.io "25-machineconfig-master-reboot" deleted</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Wait for all master nodes to reboot.</strong> Similar to the worker nodes, monitor the master nodes using <code>oc get nodes</code>. Confirm that all master nodes have rebooted and are in a <code>Ready</code> state.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification:</div>
<p>After both worker and master nodes have rebooted, they will now be using the custom DNS servers you configured in the virtual network. You can verify this by logging into a node (e.g., via <code>oc debug node/&lt;node-name&gt;</code>) and inspecting its <code>/etc/resolv.conf</code> file, which should now reflect your custom DNS server IP addresses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">search reddog.microsoft.com &lt;your-vnet-domain&gt;
nameserver 192.168.0.1 &lt;your-custom-dns-ip&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The <code>nameserver</code> entry should now point to your custom DNS server(s). This indicates that the ARO nodes are forwarding their DNS queries to your specified custom DNS infrastructure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As noted previously, once you configure custom DNS, virtual machine names within the Azure virtual network might no longer resolve through DNS unless your custom DNS server is configured to handle these internal resolutions. Nodes will primarily be reachable via their IP addresses for direct VNet communication.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By following these steps, you have successfully configured custom DNS for your Azure Red Hat OpenShift cluster, ensuring that all cluster nodes utilize your specified DNS infrastructure for name resolution and effectively implementing DNS forwarding from the cluster&#8217;s perspective to your custom servers.</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuring-log-forwarding.html">Configuring log forwarding</a></span>
  <span class="next"><a href="../registry-integrations/registry-integrations.html">Registry Integrations</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
