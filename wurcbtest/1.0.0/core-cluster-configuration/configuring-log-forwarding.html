<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring log forwarding :: Advanced Administration of Azure Red Hat OpenShift</title>
    <link rel="prev" href="configuring-node-autoscaling.html">
    <link rel="next" href="configuring-custom-dns-and-dns-forwarding.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Administration of Azure Red Hat OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="wurcbtest" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/azure-red-hat-openshift-architecture-and-overview.html">Azure Red Hat OpenShift Architecture and Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/aro-platform-capabilities.html">ARO platform capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/joint-engineering-operation-and-support-model.html">Joint engineering, operation, and support model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/managed-control-plane-and-infrastructure.html">Managed control plane and infrastructure</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../aro-cluster-provisioning/aro-cluster-provisioning.html">ARO Cluster Provisioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-an-azure-red-hat-openshift-cluster.html">Creating an Azure Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-a-private-azure-red-hat-openshift-cluster.html">Creating a private Azure Red Hat OpenShift cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="core-cluster-configuration.html">Core Cluster Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-additional-storage-classes.html">Configuring additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-node-autoscaling.html">Configuring node autoscaling</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configuring-log-forwarding.html">Configuring log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registry-integrations/registry-integrations.html">Registry Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-azure-container-registry-acr.html">Integrating with Azure Container Registry (ACR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-quay.html">Integrating with Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/using-the-internal-openshift-registry.html">Using the internal OpenShift registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-application-data-management/cluster-application-data-management.html">Cluster Application Data Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-application-data-management/backup-and-restore-of-cluster-applications-using-velero.html">Backup and restore of cluster applications using Velero</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/openshift-and-kubernetes-interfaces.html">OpenShift and Kubernetes Interfaces</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/navigating-the-openshift-web-console.html">Navigating the OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-kubernetes-command-line-interface-cli.html">Utilizing the Kubernetes Command-line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-openshift-command-line-interface-cli.html">Utilizing the OpenShift Command-line Interface (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-and-application-management.html">Troubleshooting and Application Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-containers-and-pods.html">Troubleshooting containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/managing-applications-using-the-kubernetes-workload-api.html">Managing applications using the Kubernetes Workload API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/kubernetes-networking-and-application-exposure.html">Kubernetes Networking and Application Exposure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/understanding-kubernetes-pod-and-service-networks.html">Understanding Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/scaling-and-exposing-applications-to-external-access.html">Scaling and exposing applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/externalizing-application-configurations.html">Externalizing application configurations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-security-policies/network-security-policies.html">Network Security Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/configuring-network-policies.html">Configuring network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/limiting-ingress-traffic.html">Limiting ingress traffic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gitops-for-cluster-administration/gitops-for-cluster-administration.html">GitOps for Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/implementing-openshift-gitops.html">Implementing OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/using-argocd-for-declarative-cluster-management.html">Using ArgoCD for declarative cluster management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../multi-cluster-management/multi-cluster-management.html">Multi-Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/overview-of-red-hat-advanced-cluster-management-rhacm.html">Overview of Red Hat Advanced Cluster Management (RHACM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/managing-kubernetes-clusters-with-rhacm.html">Managing Kubernetes clusters with RHACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../knowledge-share-and-discussions/knowledge-share-and-discussions.html">Knowledge Share and Discussions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-ad-with-openshift-oauth.html">Integrating Azure AD with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-key-vault-with-aro.html">Integrating Azure Key Vault with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/differentiating-availability-sets-vs-availability-zones.html">Differentiating Availability Sets vs. Availability Zones</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/understanding-azure-spot-instances.html">Understanding Azure Spot Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/exploring-hosted-control-planes.html">Exploring Hosted Control Planes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab/hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-an-azure-red-hat-openshift-cluster.html">Create an Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-additional-storage-classes.html">Configure additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-dedicated-machine-sets.html">Create dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-node-autoscaling.html">Configure node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-log-forwarding.html">Configure log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-a-private-azure-red-hat-openshift-cluster.html">Create a private Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-custom-dns-and-dns-forwarding.html">Configure custom DNS and DNS forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-registry-integrations-with-aro.html">Implement registry integrations with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/perform-backup-and-restore-of-a-cluster-application-with-velero.html">Perform backup and restore of a cluster application with Velero</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/troubleshoot-containers-and-pods.html">Troubleshoot containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-applications-using-the-kubernetes-workload-api.html">Manage applications using the Kubernetes Workload API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/explore-kubernetes-pod-and-service-networks.html">Explore Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/scale-and-expose-applications-to-external-access.html">Scale and expose applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/externalize-application-configurations.html">Externalize application configurations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-a-cluster-using-red-hat-advanced-cluster-management.html">Manage a cluster using Red Hat Advanced Cluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Administration of Azure Red Hat OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></li>
    <li><a href="core-cluster-configuration.html">Core Cluster Configuration</a></li>
    <li><a href="configuring-log-forwarding.html">Configuring log forwarding</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring log forwarding</h1>
<h1 id="_configuring_log_forwarding_in_azure_red_hat_openshift" class="sect0"><a class="anchor" href="#_configuring_log_forwarding_in_azure_red_hat_openshift"></a>Configuring Log Forwarding in Azure Red Hat OpenShift</h1>
<div class="paragraph">
<p>This section details how to configure log forwarding in Azure Red Hat OpenShift (ARO), enabling centralized collection and analysis of cluster logs.</p>
</div>
<div class="sect1">
<h2 id="_understanding_log_forwarding_in_aro"><a class="anchor" href="#_understanding_log_forwarding_in_aro"></a>Understanding Log Forwarding in ARO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a complex, distributed environment like Azure Red Hat OpenShift, efficient log management is crucial for monitoring, troubleshooting, auditing, and maintaining the health and security of your applications and infrastructure. Log forwarding involves collecting logs from various sources within your ARO cluster and sending them to an external, centralized logging solution for storage, analysis, and visualization.</p>
</div>
<div class="sect2">
<h3 id="_why_forward_logs"><a class="anchor" href="#_why_forward_logs"></a>Why Forward Logs?</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Centralized Visibility:</strong> Aggregate logs from all pods, nodes, and OpenShift components into a single platform.</p>
</li>
<li>
<p><strong>Enhanced Troubleshooting:</strong> Quickly diagnose issues by searching and correlating logs across the entire cluster.</p>
</li>
<li>
<p><strong>Compliance and Auditing:</strong> Store logs securely for compliance requirements and security auditing.</p>
</li>
<li>
<p><strong>Performance Monitoring:</strong> Analyze log patterns to identify performance bottlenecks and system anomalies.</p>
</li>
<li>
<p><strong>Long-term Storage:</strong> Retain logs for extended periods, beyond the lifecycle of individual pods or nodes.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_logging_architecture"><a class="anchor" href="#_openshift_logging_architecture"></a>OpenShift Logging Architecture</h3>
<div class="paragraph">
<p>OpenShift Container Platform (OCP), and by extension ARO, leverages the Cluster Logging Operator to manage the logging subsystem. The core components involved in log forwarding include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cluster Logging Operator (CLO):</strong> This operator manages the deployment and lifecycle of the logging components. It&#8217;s responsible for deploying Fluentd/Fluent Bit and other logging resources.</p>
</li>
<li>
<p><strong>Fluentd / Fluent Bit:</strong> These are high-performance, lightweight log processors and forwarders that run as DaemonSets on each worker node and sometimes as a Deployment for collecting audit logs. They collect logs from container <code>stdout</code>/<code>stderr</code>, node journal, and OpenShift audit logs.</p>
</li>
<li>
<p><strong>ClusterLogForwarder Custom Resource (CR):</strong> This OpenShift custom resource defines the destinations for your logs (e.g., Azure Log Analytics, Splunk, Kafka, HTTP endpoints) and specifies which types of logs (application, infrastructure, audit) should be forwarded to which destination.</p>
</li>
<li>
<p><strong>ClusterLogging Custom Resource (CR):</strong> This CR is used to deploy and configure the core logging stack (Fluentd/Fluent Bit). While you <strong>can</strong> include an internal Elasticsearch/OpenSearch for log storage, the focus for forwarding is often to external systems. For simple forwarding without internal storage, you typically define a minimal <code>ClusterLogging</code> instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log Flow in OpenShift</div>
<p>Logs generated by applications (containers) are written to <code>stdout</code> and <code>stderr</code>. The container runtime captures these logs, which are then collected by Fluentd/Fluent Bit agents running on each node. The Cluster Logging Operator, configured via a <code>ClusterLogForwarder</code> resource, processes these collected logs and sends them to the specified external destination.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<a class="image" href="https://example.com/aro-log-forwarding-flow.png"><img src="aro-log-forwarding-flow.png" alt="Log Forwarding Flow Diagram" width="800"></a>
</div>
</div>
<div class="paragraph">
<p><em>Diagram: High-level overview of log forwarding in ARO, showing log sources, Fluentd/Fluent Bit, and external destinations.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_types_of_logs"><a class="anchor" href="#_types_of_logs"></a>Types of Logs</h3>
<div class="paragraph">
<p>The Cluster Logging solution can forward three main types of logs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Application logs:</strong> Logs generated by user applications running in pods. These are typically collected from <code>stdout</code> and <code>stderr</code>.</p>
</li>
<li>
<p><strong>Infrastructure logs:</strong> Logs from the OpenShift platform components themselves, such as <code>kubelet</code>, <code>kube-proxy</code>, <code>CRI-O</code>, <code>etcd</code>, <code>controller-manager</code>, etc. These provide insights into the health and operation of the cluster.</p>
</li>
<li>
<p><strong>Audit logs:</strong> Security-relevant chronological records of events, such as API requests to the Kubernetes API server or OpenShift OAuth server. These are crucial for security monitoring and compliance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>Before configuring log forwarding, ensure you have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An existing Azure Red Hat OpenShift (ARO) cluster.</p>
</li>
<li>
<p><code>kubeadmin</code> credentials or an OpenShift user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>The <code>oc</code> CLI tool configured and authenticated to your ARO cluster.</p>
</li>
<li>
<p>An external logging solution provisioned and accessible. For this guide, we&#8217;ll use an Azure Log Analytics Workspace.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_configuring_log_forwarding_to_azure_log_analytics"><a class="anchor" href="#_hands_on_activity_configuring_log_forwarding_to_azure_log_analytics"></a>Hands-on Activity: Configuring Log Forwarding to Azure Log Analytics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this hands-on lab, you will configure your ARO cluster to forward application, infrastructure, and audit logs to an Azure Log Analytics Workspace.</p>
</div>
<div class="sect2">
<h3 id="_step_1_create_an_azure_log_analytics_workspace"><a class="anchor" href="#_step_1_create_an_azure_log_analytics_workspace"></a>Step 1: Create an Azure Log Analytics Workspace</h3>
<div class="paragraph">
<p>First, you need an Azure Log Analytics Workspace to receive the logs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open your Azure Cloud Shell or a local terminal with Azure CLI installed.</p>
</li>
<li>
<p>Create a resource group for your Log Analytics Workspace (if you don&#8217;t have one).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">AZ_RG="aro-log-rg"
AZ_LOCATION="eastus" # Use the same location as your ARO cluster for optimal performance
az group create --name $AZ_RG --location $AZ_LOCATION</code></pre>
</div>
</div>
</li>
<li>
<p>Create the Log Analytics Workspace.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">AZ_LA_WORKSPACE_NAME="aro-logs-workspace"
az monitor log-analytics workspace create \
    --resource-group $AZ_RG \
    --workspace-name $AZ_LA_WORKSPACE_NAME \
    --location $AZ_LOCATION</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the Workspace ID and Primary Shared Key. You will need these to configure the log forwarder in OpenShift.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">AZ_LA_WORKSPACE_ID=$(az monitor log-analytics workspace show \
    --resource-group $AZ_RG \
    --workspace-name $AZ_LA_WORKSPACE_NAME \
    --query customerId --output tsv)
echo "Log Analytics Workspace ID: $AZ_LA_WORKSPACE_ID"

AZ_LA_PRIMARY_SHARED_KEY=$(az monitor log-analytics workspace get-shared-keys \
    --resource-group $AZ_RG \
    --workspace-name $AZ_LA_WORKSPACE_NAME \
    --query primarySharedKey --output tsv)
echo "Log Analytics Primary Shared Key: $AZ_LA_PRIMARY_SHARED_KEY"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_install_the_openshift_logging_operator"><a class="anchor" href="#_step_2_install_the_openshift_logging_operator"></a>Step 2: Install the OpenShift Logging Operator</h3>
<div class="paragraph">
<div class="title">Keep these values handy. You&#8217;ll use them to create a Kubernetes Secret.</div>
<p>The Cluster Logging Operator manages the logging stack.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the OpenShift Web Console as <code>kubeadmin</code> or a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>Navigate to <code>Operators</code> &#8594; <code>OperatorHub</code>.</p>
</li>
<li>
<p>Search for "OpenShift Logging" and select it.</p>
</li>
<li>
<p>Click <code>Install</code>.</p>
</li>
<li>
<p>On the "Install Operator" page:</p>
<div class="ulist">
<ul>
<li>
<p>Set <code>Installation mode</code> to <code>All namespaces on the cluster (default)</code>.</p>
</li>
<li>
<p>Set <code>Update channel</code> to the recommended stable channel (e.g., <code>stable-5.x</code>).</p>
</li>
<li>
<p>Set <code>Approval strategy</code> to <code>Automatic</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <code>Install</code>.</p>
</li>
<li>
<p>Wait for the operator to be installed. You can verify its status under <code>Operators</code> &#8594; <code>Installed Operators</code>. It should show <code>Succeeded</code> in the <code>openshift-logging</code> project.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_create_a_clusterlogging_instance"><a class="anchor" href="#_step_3_create_a_clusterlogging_instance"></a>Step 3: Create a <code>ClusterLogging</code> Instance</h3>
<div class="paragraph">
<p>A minimal <code>ClusterLogging</code> instance is required to deploy the Fluentd/Fluent Bit log collectors, even if you&#8217;re not using the internal Elasticsearch.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the OpenShift Web Console, navigate to <code>Operators</code> &#8594; <code>Installed Operators</code>.</p>
</li>
<li>
<p>Click on the "OpenShift Logging" operator in the <code>openshift-logging</code> project.</p>
</li>
<li>
<p>Go to the <code>Cluster Logging</code> tab.</p>
</li>
<li>
<p>Click <code>Create ClusterLogging</code>.</p>
</li>
<li>
<p>Switch to the <code>YAML view</code> and replace the content with the following minimal configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: "logging.openshift.io/v1"
kind: "ClusterLogging"
metadata:
  name: "instance"
  namespace: "openshift-logging"
spec:
  managementState: "Managed"
  logStore:
    type: "none" # We are not using an internal log store for this exercise
  visualization:
    type: "none" # We are not using internal visualization
  collection:
    logs:
      type: "fluentd" # Use fluentd as the log collector</code></pre>
</div>
</div>
</li>
<li>
<p>Click <code>Create</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Wait for the <code>log-collector-*</code> pods to be created and become <code>Running</code> in the <code>openshift-logging</code> namespace. You can monitor this from <code>Workloads</code> &#8594; <code>Pods</code> or using <code>oc get pods -n openshift-logging</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_create_a_secret_for_log_analytics_credentials"><a class="anchor" href="#_step_4_create_a_secret_for_log_analytics_credentials"></a>Step 4: Create a Secret for Log Analytics Credentials</h3>
<div class="paragraph">
<p>The Log Analytics Workspace ID and Shared Key are sensitive. Store them in a Kubernetes Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Base64 encode your Workspace ID and Primary Shared Key.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo -n "$AZ_LA_WORKSPACE_ID" | base64
echo -n "$AZ_LA_PRIMARY_SHARED_KEY" | base64</code></pre>
</div>
</div>
</li>
<li>
<p>Replace the <code>workspaceId</code> and <code>sharedKey</code> values in the YAML below with your base64-encoded strings.</p>
</li>
<li>
<p>Create the Secret in the <code>openshift-logging</code> namespace.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: log-analytics-secret
  namespace: openshift-logging
stringData:
  # Replace with your actual Workspace ID
  workspaceId: "&lt;YOUR_BASE64_ENCODED_WORKSPACE_ID&gt;"
  # Replace with your actual Primary Shared Key
  sharedKey: "&lt;YOUR_BASE64_ENCODED_PRIMARY_SHARED_KEY&gt;"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Secret
metadata:
  name: log-analytics-secret
  namespace: openshift-logging
stringData:
  workspaceId: "your-base64-encoded-workspace-id"
  sharedKey: "your-base64-encoded-primary-shared-key"
EOF</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_create_a_clusterlogforwarder_instance"><a class="anchor" href="#_step_5_create_a_clusterlogforwarder_instance"></a>Step 5: Create a <code>ClusterLogForwarder</code> Instance</h3>
<div class="paragraph">
<p>Now, define the <code>ClusterLogForwarder</code> resource to direct logs to Azure Log Analytics.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the OpenShift Web Console, navigate to <code>Operators</code> &#8594; <code>Installed Operators</code>.</p>
</li>
<li>
<p>Click on the "OpenShift Logging" operator in the <code>openshift-logging</code> project.</p>
</li>
<li>
<p>Go to the <code>Cluster Log Forwarders</code> tab.</p>
</li>
<li>
<p>Click <code>Create ClusterLogForwarder</code>.</p>
</li>
<li>
<p>Switch to the <code>YAML view</code> and replace the content with the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: "logging.openshift.io/v1"
kind: "ClusterLogForwarder"
metadata:
  name: "instance"
  namespace: "openshift-logging"
spec:
  outputs:
    - name: log-analytics-output
      type: azureMonitor
      azureMonitor:
        customerId:
          secret:
            key: workspaceId
            name: log-analytics-secret
        sharedKey:
          secret:
            key: sharedKey
            name: log-analytics-secret
  pipelines:
    - name: app-logs-to-la
      inputRefs:
        - application
      outputRefs:
        - log-analytics-output
      labels:
        log_type: application
    - name: infra-logs-to-la
      inputRefs:
        - infrastructure
      outputRefs:
        - log-analytics-output
      labels:
        log_type: infrastructure
    - name: audit-logs-to-la
      inputRefs:
        - audit
      outputRefs:
        - log-analytics-output
      labels:
        log_type: audit</code></pre>
</div>
</div>
</li>
<li>
<p>Click <code>Create</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Explanation of the <code>ClusterLogForwarder</code></div>
<ul>
<li>
<p>The <code>outputs</code> section defines <code>log-analytics-output</code> of <code>type: azureMonitor</code>. It references the <code>log-analytics-secret</code> for <code>customerId</code> (Workspace ID) and <code>sharedKey</code>.</p>
</li>
<li>
<p>The <code>pipelines</code> section defines three pipelines:</p>
</li>
<li>
<p><code>app-logs-to-la</code>: Forwards <code>application</code> logs.</p>
</li>
<li>
<p><code>infra-logs-to-la</code>: Forwards <code>infrastructure</code> logs.</p>
</li>
<li>
<p><code>audit-logs-to-la</code>: Forwards <code>audit</code> logs.</p>
</li>
<li>
<p>All pipelines use <code>log-analytics-output</code> as their destination.</p>
</li>
<li>
<p><code>labels</code> are added to distinguish log types within Log Analytics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>After creating the <code>ClusterLogForwarder</code>, the Cluster Logging Operator will reconcile the changes. This might cause the <code>log-collector-*</code> pods to restart as new configurations are applied.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_6_verify_log_forwarding_in_azure_log_analytics"><a class="anchor" href="#_step_6_verify_log_forwarding_in_azure_log_analytics"></a>Step 6: Verify Log Forwarding in Azure Log Analytics</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy a sample application to generate some logs.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: log-generator
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-generator
  template:
    metadata:
      labels:
        app: log-generator
    spec:
      containers:
      - name: log-generator
        image: busybox
        command: ["sh", "-c"]
        args:
        - while true; do
            echo "$(date) - Hello from ARO log generator!";
            sleep 5;
          done</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f - &lt;&lt;EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: log-generator
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-generator
  template:
    metadata:
      labels:
        app: log-generator
    spec:
      containers:
      - name: log-generator
        image: busybox
        command: ["sh", "-c"]
        args:
        - while true; do
            echo "$(date) - Hello from ARO log generator!";
            sleep 5;
          done
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Open the Azure Portal and navigate to your Log Analytics Workspace (<code>aro-logs-workspace</code>).</p>
</li>
<li>
<p>In the workspace, click on <code>Logs</code> under the <code>General</code> section.</p>
</li>
<li>
<p>Close any pop-ups and enter the following Kusto Query Language (KQL) query:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kql hljs" data-lang="kql">ContainerLogV2
| where ClusterName == "your-aro-cluster-name" // Replace with your ARO cluster name
| where ContainerName == "log-generator"
| project TimeGenerated, LogMessage
| order by TimeGenerated desc</code></pre>
</div>
</div>
</li>
<li>
<p>Click <code>Run</code>. You should start seeing logs from your <code>log-generator</code> application appearing in Log Analytics.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional Queries</div>
<ul>
<li>
<p>To see all <code>application</code> logs forwarded:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kql hljs" data-lang="kql">ContainerLogV2
| where labels.log_type == "application"
| limit 50
| project TimeGenerated, LogMessage</code></pre>
</div>
</div>
</li>
<li>
<p>To see <code>infrastructure</code> logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kql hljs" data-lang="kql">ContainerLogV2
| where labels.log_type == "infrastructure"
| limit 50
| project TimeGenerated, LogMessage</code></pre>
</div>
</div>
</li>
<li>
<p>To see <code>audit</code> logs (these might appear in a different table like <code>KubeAudit</code> or <code>ContainerLogV2</code> depending on configuration and version, so start by searching <code>ContainerLogV2</code> with <code>labels.log_type == "audit"</code> or explore tables like <code>KubeAudit</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kql hljs" data-lang="kql">ContainerLogV2
| where labels.log_type == "audit"
| limit 50
| project TimeGenerated, LogMessage</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t immediately see audit logs, try querying <code>KubeAudit</code> or <code>AzureDiagnostics</code> tables if they exist and contain audit events. The exact table for audit logs can vary.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting_log_forwarding"><a class="anchor" href="#_troubleshooting_log_forwarding"></a>Troubleshooting Log Forwarding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If logs are not appearing in your external destination, consider the following troubleshooting steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check <code>ClusterLogging</code> and <code>ClusterLogForwarder</code> Status</p>
<div class="ulist">
<ul>
<li>
<p>In the OpenShift Web Console, navigate to <code>Operators</code> &#8594; <code>Installed Operators</code> &#8594; <code>OpenShift Logging</code>.</p>
</li>
<li>
<p>Check the <code>Cluster Logging</code> and <code>Cluster Log Forwarders</code> tabs. Ensure both instances show a <code>Healthy</code> status and no errors in their conditions.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Examine <code>log-collector</code> Pods</p>
<div class="ulist">
<ul>
<li>
<p>The <code>log-collector-*</code> pods (Fluentd/Fluent Bit) are responsible for collecting and forwarding logs. Check their status and logs.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n openshift-logging -l logging-infra=collector
oc logs -f &lt;log-collector-pod-name&gt; -n openshift-logging</code></pre>
</div>
</div>
</li>
<li>
<p>Look for errors related to connecting to the external destination, authentication issues, or parsing problems.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify Network Connectivity</p>
<div class="ulist">
<ul>
<li>
<p>Ensure that the <code>openshift-logging</code> namespace, specifically the <code>log-collector</code> pods, has network egress connectivity to the Azure Log Analytics endpoint. Azure Red Hat OpenShift clusters typically have outbound internet access by default, but custom Network Policies or egress firewalls could block traffic.</p>
</li>
<li>
<p>The Azure Log Analytics endpoint is <code><a href="https://&lt;Workspace" class="bare">https://&lt;Workspace</a> ID&gt;.ods.opinsights.azure.com</code>. You can attempt a <code>curl</code> from within a <code>log-collector</code> pod if you exec into it, but this might require adding <code>curl</code> temporarily.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recheck Secret and Output Configuration</p>
<div class="ulist">
<ul>
<li>
<p>Ensure that the <code>log-analytics-secret</code> contains the correct base64-encoded Workspace ID and Shared Key.</p>
</li>
<li>
<p>Verify that the <code>ClusterLogForwarder</code> YAML correctly references the secret keys (<code>workspaceId</code> and <code>sharedKey</code>) and the secret name (<code>log-analytics-secret</code>). Typographical errors are common.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Increase Verbosity (for advanced troubleshooting)</p>
<div class="ulist">
<ul>
<li>
<p>For Fluentd/Fluent Bit, you can sometimes adjust logging levels in the <code>ClusterLogging</code> CR, but this is less common for simple forwarding issues. Refer to OpenShift documentation for advanced <code>ClusterLogging</code> configuration.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Consult OpenShift and Azure Documentation</p>
<div class="ulist">
<ul>
<li>
<p>Refer to the official Red Hat OpenShift documentation for Cluster Logging: <a href="https://docs.openshift.com/container-platform/latest/logging/cluster-logging-ossm-log-collection.html">OpenShift Logging Overview</a></p>
</li>
<li>
<p>Refer to Azure Monitor documentation for Log Analytics integration: <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-sources-kubernetes">Collect Kubernetes logs with Azure Monitor</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This guide provides a comprehensive approach to setting up log forwarding from your ARO cluster to Azure Log Analytics, a crucial step for effective cluster management and observability.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuring-node-autoscaling.html">Configuring node autoscaling</a></span>
  <span class="next"><a href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
