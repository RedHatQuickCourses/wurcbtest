<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring node autoscaling :: Advanced Administration of Azure Red Hat OpenShift</title>
    <link rel="prev" href="creating-dedicated-machine-sets.html">
    <link rel="next" href="configuring-log-forwarding.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Administration of Azure Red Hat OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="wurcbtest" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/azure-red-hat-openshift-architecture-and-overview.html">Azure Red Hat OpenShift Architecture and Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/aro-platform-capabilities.html">ARO platform capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/joint-engineering-operation-and-support-model.html">Joint engineering, operation, and support model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/managed-control-plane-and-infrastructure.html">Managed control plane and infrastructure</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../aro-cluster-provisioning/aro-cluster-provisioning.html">ARO Cluster Provisioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-an-azure-red-hat-openshift-cluster.html">Creating an Azure Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-a-private-azure-red-hat-openshift-cluster.html">Creating a private Azure Red Hat OpenShift cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="core-cluster-configuration.html">Core Cluster Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-additional-storage-classes.html">Configuring additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configuring-node-autoscaling.html">Configuring node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-log-forwarding.html">Configuring log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registry-integrations/registry-integrations.html">Registry Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-azure-container-registry-acr.html">Integrating with Azure Container Registry (ACR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-quay.html">Integrating with Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/using-the-internal-openshift-registry.html">Using the internal OpenShift registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-application-data-management/cluster-application-data-management.html">Cluster Application Data Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-application-data-management/backup-and-restore-of-cluster-applications-using-velero.html">Backup and restore of cluster applications using Velero</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/openshift-and-kubernetes-interfaces.html">OpenShift and Kubernetes Interfaces</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/navigating-the-openshift-web-console.html">Navigating the OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-kubernetes-command-line-interface-cli.html">Utilizing the Kubernetes Command-line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-openshift-command-line-interface-cli.html">Utilizing the OpenShift Command-line Interface (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-and-application-management.html">Troubleshooting and Application Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-containers-and-pods.html">Troubleshooting containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/managing-applications-using-the-kubernetes-workload-api.html">Managing applications using the Kubernetes Workload API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/kubernetes-networking-and-application-exposure.html">Kubernetes Networking and Application Exposure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/understanding-kubernetes-pod-and-service-networks.html">Understanding Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/scaling-and-exposing-applications-to-external-access.html">Scaling and exposing applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/externalizing-application-configurations.html">Externalizing application configurations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-security-policies/network-security-policies.html">Network Security Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/configuring-network-policies.html">Configuring network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/limiting-ingress-traffic.html">Limiting ingress traffic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gitops-for-cluster-administration/gitops-for-cluster-administration.html">GitOps for Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/implementing-openshift-gitops.html">Implementing OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/using-argocd-for-declarative-cluster-management.html">Using ArgoCD for declarative cluster management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../multi-cluster-management/multi-cluster-management.html">Multi-Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/overview-of-red-hat-advanced-cluster-management-rhacm.html">Overview of Red Hat Advanced Cluster Management (RHACM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/managing-kubernetes-clusters-with-rhacm.html">Managing Kubernetes clusters with RHACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../knowledge-share-and-discussions/knowledge-share-and-discussions.html">Knowledge Share and Discussions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-ad-with-openshift-oauth.html">Integrating Azure AD with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-key-vault-with-aro.html">Integrating Azure Key Vault with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/differentiating-availability-sets-vs-availability-zones.html">Differentiating Availability Sets vs. Availability Zones</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/understanding-azure-spot-instances.html">Understanding Azure Spot Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/exploring-hosted-control-planes.html">Exploring Hosted Control Planes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab/hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-an-azure-red-hat-openshift-cluster.html">Create an Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-additional-storage-classes.html">Configure additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-dedicated-machine-sets.html">Create dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-node-autoscaling.html">Configure node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-log-forwarding.html">Configure log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-a-private-azure-red-hat-openshift-cluster.html">Create a private Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-custom-dns-and-dns-forwarding.html">Configure custom DNS and DNS forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-registry-integrations-with-aro.html">Implement registry integrations with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/perform-backup-and-restore-of-a-cluster-application-with-velero.html">Perform backup and restore of a cluster application with Velero</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/troubleshoot-containers-and-pods.html">Troubleshoot containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-applications-using-the-kubernetes-workload-api.html">Manage applications using the Kubernetes Workload API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/explore-kubernetes-pod-and-service-networks.html">Explore Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/scale-and-expose-applications-to-external-access.html">Scale and expose applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/externalize-application-configurations.html">Externalize application configurations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-a-cluster-using-red-hat-advanced-cluster-management.html">Manage a cluster using Red Hat Advanced Cluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Administration of Azure Red Hat OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></li>
    <li><a href="core-cluster-configuration.html">Core Cluster Configuration</a></li>
    <li><a href="configuring-node-autoscaling.html">Configuring node autoscaling</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring node autoscaling</h1>
<h1 id="_configuring_node_autoscaling" class="sect0"><a class="anchor" href="#_configuring_node_autoscaling"></a>Configuring Node Autoscaling</h1>
<div class="paragraph">
<p>The ability to automatically adjust the number of worker nodes in an Azure Red Hat OpenShift (ARO) cluster is a critical feature for managing application performance, optimizing resource utilization, and controlling operational costs. This section will delve into the technical aspects of configuring node autoscaling in ARO and provide a hands-on lab to implement it.</p>
</div>
<div class="sect1">
<h2 id="_understanding_node_autoscaling_in_aro"><a class="anchor" href="#_understanding_node_autoscaling_in_aro"></a>Understanding Node Autoscaling in ARO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node autoscaling in Azure Red Hat OpenShift is managed by the <strong>Cluster Autoscaler</strong> component. This component dynamically adjusts the size of your OpenShift cluster by increasing or decreasing the number of worker nodes based on the pending state of pods and the resource demands of your workloads.</p>
</div>
<div class="paragraph">
<p>When a workload requires more resources than currently available, or when new pods are scheduled but cannot find a suitable node, the Cluster Autoscaler steps in. It works by monitoring pod events and communicating with the underlying Azure Virtual Machine Scale Sets (VMSS) that back the OpenShift MachineSets.</p>
</div>
<div class="paragraph">
<p>The primary goals of node autoscaling are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cost Optimization</strong>: Automatically scales down nodes during periods of low demand, reducing cloud infrastructure costs.</p>
</li>
<li>
<p><strong>Performance and Availability</strong>: Ensures applications have sufficient resources to run optimally by scaling up nodes during peak demand, preventing performance degradation and application outages.</p>
</li>
<li>
<p><strong>Operational Efficiency</strong>: Reduces the need for manual intervention to adjust cluster capacity, allowing administrators to focus on higher-value tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In ARO, you interact with the Cluster Autoscaler through OpenShift&#8217;s <code>MachineSet</code> and <code>MachineAutoscaler</code> objects. Each <code>MachineSet</code> defines a group of machines (VMs) with specific characteristics (e.g., instance type, region, labels). A <code>MachineAutoscaler</code> then targets a specific <code>MachineSet</code> to control its replica count within defined minimum and maximum limits.</p>
</div>
<div class="ulist">
<div class="title">Key Concepts:</div>
<ul>
<li>
<p><strong>MachineSet</strong>: A Kubernetes object that manages a set of machines (VMs) in a cluster. In ARO, worker nodes are provisioned as part of MachineSets. You typically have at least one default MachineSet for your worker nodes.</p>
</li>
<li>
<p><strong>MachineAutoscaler</strong>: A custom resource that links to a specific MachineSet and defines the minimum (<code>minReplicas</code>) and maximum (<code>maxReplicas</code>) number of nodes for that set. The Cluster Autoscaler uses these parameters to decide when to scale up or down.</p>
</li>
<li>
<p><strong>Cluster Autoscaler</strong>: The controller that watches for unschedulable pods, evaluates node utilization, and then instructs the MachineAutoscaler (and through it, the underlying Azure VMSS) to add or remove nodes.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_how_aro_manages_node_autoscaling"><a class="anchor" href="#_how_aro_manages_node_autoscaling"></a>How ARO Manages Node Autoscaling</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Monitoring Pods</strong>: The Cluster Autoscaler continuously monitors the OpenShift cluster for pods that are in a <code>Pending</code> state due to insufficient resources (CPU, memory, storage) or node selectors/taints.</p>
</li>
<li>
<p><strong>Resource Evaluation</strong>: When <code>Pending</code> pods are detected, the Cluster Autoscaler performs a "dry run" to see if adding one or more new nodes from an existing <code>MachineSet</code> (that has a <code>MachineAutoscaler</code> defined) would allow the pods to be scheduled.</p>
</li>
<li>
<p><strong>Scaling Up</strong>: If adding nodes would resolve the <code>Pending</code> state and the current number of nodes in the targeted <code>MachineSet</code> is below its <code>maxReplicas</code> limit, the Cluster Autoscaler instructs the <code>MachineAutoscaler</code> to increase the replica count. This triggers Azure to provision new VMs in the corresponding VMSS.</p>
</li>
<li>
<p><strong>Scaling Down</strong>: Conversely, the Cluster Autoscaler also monitors node utilization. If a node is underutilized (i.e., its resource requests are below a configurable threshold) and all its pods can be safely evicted and rescheduled onto other existing nodes, the Cluster Autoscaler can instruct the <code>MachineAutoscaler</code> to decrease the replica count, leading to the deprovisioning of an idle node. Node readiness and existing workloads are carefully considered to prevent disruption.</p>
</li>
<li>
<p><strong>Grace Periods</strong>: There are configurable cooldown periods to prevent rapid, unnecessary scaling changes, ensuring cluster stability.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In Azure Red Hat OpenShift, the control plane nodes are fully managed by Microsoft and Red Hat and are not subject to user-configurable autoscaling. Node autoscaling in ARO applies exclusively to the worker nodes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_configuring_node_autoscaling"><a class="anchor" href="#_hands_on_activity_configuring_node_autoscaling"></a>Hands-on Activity: Configuring Node Autoscaling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you will identify your existing worker MachineSet and then create a <code>MachineAutoscaler</code> object to enable and configure node autoscaling for it.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>An existing Azure Red Hat OpenShift cluster.</p>
</li>
<li>
<p>The <code>oc</code> CLI tool configured and logged in to your ARO cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_procedure"><a class="anchor" href="#_procedure"></a>Procedure</h3>
<div class="paragraph">
<div class="title">Log in to your ARO cluster using the <code>oc</code> CLI:</div>
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc login &lt;your_api_server_url&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Provide your <code>kubeadmin</code> credentials or other valid OpenShift credentials.</p>
</div>
<div class="paragraph">
<div class="title">Identify the default worker MachineSet:</div>
<p>+
Your ARO cluster typically comes with one or more default MachineSets for worker nodes. You need to find the name of the MachineSet you want to autoscale.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get machinesets -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
You will see output similar to this:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">NAME                            DESIRED   CURRENT   READY   AVAILABLE   AGE
aro-cluster-xxxx-worker-eastus1   3         3         3       3           3d</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
In this example, the MachineSet name is <code>aro-cluster-xxxx-worker-eastus1</code>. Make a note of your MachineSet name.</p>
</div>
<div class="paragraph">
<div class="title">Create a <code>MachineAutoscaler</code> object:</div>
<p>+
Now, you will create a <code>MachineAutoscaler</code> custom resource that targets the MachineSet you identified. This YAML configuration specifies the minimum and maximum number of worker nodes for that MachineSet.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Replace <code>&lt;YOUR_MACHINESET_NAME&gt;</code> with the actual name of your MachineSet obtained in the previous step. Adjust <code>minReplicas</code> and <code>maxReplicas</code> according to your desired scaling range. For this lab, we&#8217;ll set it to scale between 3 and 5 nodes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
Create a file named <code>machine-autoscaler.yaml</code> with the following content:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling.openshift.io/v1beta1
kind: MachineAutoscaler
metadata:
  name: &lt;YOUR_MACHINESET_NAME&gt;-autoscaler
  namespace: openshift-machine-api
spec:
  minReplicas: 3
  maxReplicas: 5
  selector:
    matchLabels:
      machine.openshift.io/cluster-api-machine-set: &lt;YOUR_MACHINESET_NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Apply the <code>MachineAutoscaler</code> definition to your cluster:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f machine-autoscaler.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
You should see confirmation that the <code>machineautoscaler</code> was created:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">machineautoscaler.autoscaling.openshift.io/aro-cluster-xxxx-worker-eastus1-autoscaler created</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verify the <code>MachineAutoscaler</code> status:</div>
<p>+
You can check if the <code>MachineAutoscaler</code> has been created and is active:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get machineautoscalers -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
You should see your newly created autoscaler listed:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">NAME                                     MIN   MAX   REPLICAS   AGE
aro-cluster-xxxx-worker-eastus1-autoscaler   3     5     3          2m</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(Optional) Test node autoscaling:</p>
<div class="paragraph">
<p>To observe autoscaling in action, you can deploy a large number of pods that demand more resources than your current nodes can provide. This will trigger the Cluster Autoscaler to add new nodes.</p>
</div>
<div class="paragraph">
<p>First, check the current number of worker nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get nodes -l node-role.kubernetes.io/worker</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see 3 worker nodes initially.</p>
</div>
<div class="paragraph">
<p>Now, deploy a dummy application with a high replica count, ensuring each pod requests a small amount of resources. This will exhaust the existing nodes and force new nodes to be provisioned.</p>
</div>
<div class="paragraph">
<p>Create a file named <code>heavy-workload.yaml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: cpu-intensive-app
  labels:
    app: cpu-intensive-app
spec:
  replicas: 20 # Adjust this number based on your node capacity to force scaling up
  selector:
    matchLabels:
      app: cpu-intensive-app
  template:
    metadata:
      labels:
        app: cpu-intensive-app
    spec:
      containers:
      - name: busybox
        image: quay.io/openshift/busybox:latest
        command: ["sh", "-c", "while true; do sleep 10; done"]
        resources:
          requests:
            cpu: "100m" # Request a small amount of CPU
            memory: "128Mi"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f heavy-workload.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Monitor the pods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will likely see some pods in a <code>Pending</code> state as the cluster runs out of resources.</p>
</div>
<div class="paragraph">
<p>Monitor the <code>MachineSet</code> and <code>MachineAutoscaler</code> to see the replica count change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get machinesets -n openshift-machine-api -w
oc get machineautoscalers -n openshift-machine-api -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a few minutes, you should observe the <code>DESIRED</code> and <code>CURRENT</code> counts for your MachineSet increase, and the <code>REPLICAS</code> for your MachineAutoscaler increase, eventually reaching up to 5 nodes. New nodes will appear in <code>oc get nodes</code>.</p>
</div>
<div class="paragraph">
<p>Once new nodes are ready, the pending pods will be scheduled.</p>
</div>
<div class="paragraph">
<p>To observe scaling down, delete the heavy workload:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete -f heavy-workload.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a period of inactivity (typically around 10 minutes by default), the Cluster Autoscaler will identify the underutilized nodes and scale down the MachineSet, deprovisioning the excess worker nodes until the <code>minReplicas</code> (3 in our case) is reached.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Cleanup (if you performed the optional test):</div>
<p>+
Delete the <code>MachineAutoscaler</code> if you no longer need it, to revert to a fixed number of nodes:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete machineautoscaler &lt;YOUR_MACHINESET_NAME&gt;-autoscaler -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
This concludes the configuration of node autoscaling in your Azure Red Hat OpenShift cluster.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a></span>
  <span class="next"><a href="configuring-log-forwarding.html">Configuring log forwarding</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
