<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating dedicated machine sets :: Advanced Administration of Azure Red Hat OpenShift</title>
    <link rel="prev" href="configuring-additional-storage-classes.html">
    <link rel="next" href="configuring-node-autoscaling.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Administration of Azure Red Hat OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="wurcbtest" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/azure-red-hat-openshift-architecture-and-overview.html">Azure Red Hat OpenShift Architecture and Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/aro-platform-capabilities.html">ARO platform capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/joint-engineering-operation-and-support-model.html">Joint engineering, operation, and support model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/managed-control-plane-and-infrastructure.html">Managed control plane and infrastructure</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../aro-cluster-provisioning/aro-cluster-provisioning.html">ARO Cluster Provisioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-an-azure-red-hat-openshift-cluster.html">Creating an Azure Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-a-private-azure-red-hat-openshift-cluster.html">Creating a private Azure Red Hat OpenShift cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="core-cluster-configuration.html">Core Cluster Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-additional-storage-classes.html">Configuring additional storage classes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-node-autoscaling.html">Configuring node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-log-forwarding.html">Configuring log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registry-integrations/registry-integrations.html">Registry Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-azure-container-registry-acr.html">Integrating with Azure Container Registry (ACR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-quay.html">Integrating with Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/using-the-internal-openshift-registry.html">Using the internal OpenShift registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-application-data-management/cluster-application-data-management.html">Cluster Application Data Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-application-data-management/backup-and-restore-of-cluster-applications-using-velero.html">Backup and restore of cluster applications using Velero</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/openshift-and-kubernetes-interfaces.html">OpenShift and Kubernetes Interfaces</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/navigating-the-openshift-web-console.html">Navigating the OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-kubernetes-command-line-interface-cli.html">Utilizing the Kubernetes Command-line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-openshift-command-line-interface-cli.html">Utilizing the OpenShift Command-line Interface (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-and-application-management.html">Troubleshooting and Application Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-containers-and-pods.html">Troubleshooting containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/managing-applications-using-the-kubernetes-workload-api.html">Managing applications using the Kubernetes Workload API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/kubernetes-networking-and-application-exposure.html">Kubernetes Networking and Application Exposure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/understanding-kubernetes-pod-and-service-networks.html">Understanding Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/scaling-and-exposing-applications-to-external-access.html">Scaling and exposing applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/externalizing-application-configurations.html">Externalizing application configurations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-security-policies/network-security-policies.html">Network Security Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/configuring-network-policies.html">Configuring network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/limiting-ingress-traffic.html">Limiting ingress traffic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gitops-for-cluster-administration/gitops-for-cluster-administration.html">GitOps for Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/implementing-openshift-gitops.html">Implementing OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/using-argocd-for-declarative-cluster-management.html">Using ArgoCD for declarative cluster management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../multi-cluster-management/multi-cluster-management.html">Multi-Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/overview-of-red-hat-advanced-cluster-management-rhacm.html">Overview of Red Hat Advanced Cluster Management (RHACM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/managing-kubernetes-clusters-with-rhacm.html">Managing Kubernetes clusters with RHACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../knowledge-share-and-discussions/knowledge-share-and-discussions.html">Knowledge Share and Discussions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-ad-with-openshift-oauth.html">Integrating Azure AD with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-key-vault-with-aro.html">Integrating Azure Key Vault with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/differentiating-availability-sets-vs-availability-zones.html">Differentiating Availability Sets vs. Availability Zones</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/understanding-azure-spot-instances.html">Understanding Azure Spot Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/exploring-hosted-control-planes.html">Exploring Hosted Control Planes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab/hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-an-azure-red-hat-openshift-cluster.html">Create an Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-additional-storage-classes.html">Configure additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-dedicated-machine-sets.html">Create dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-node-autoscaling.html">Configure node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-log-forwarding.html">Configure log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/create-a-private-azure-red-hat-openshift-cluster.html">Create a private Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-custom-dns-and-dns-forwarding.html">Configure custom DNS and DNS forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-registry-integrations-with-aro.html">Implement registry integrations with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/perform-backup-and-restore-of-a-cluster-application-with-velero.html">Perform backup and restore of a cluster application with Velero</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/troubleshoot-containers-and-pods.html">Troubleshoot containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-applications-using-the-kubernetes-workload-api.html">Manage applications using the Kubernetes Workload API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/explore-kubernetes-pod-and-service-networks.html">Explore Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/scale-and-expose-applications-to-external-access.html">Scale and expose applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/externalize-application-configurations.html">Externalize application configurations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab/manage-a-cluster-using-red-hat-advanced-cluster-management.html">Manage a cluster using Red Hat Advanced Cluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Administration of Azure Red Hat OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></li>
    <li><a href="core-cluster-configuration.html">Core Cluster Configuration</a></li>
    <li><a href="creating-dedicated-machine-sets.html">Creating dedicated machine sets</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Creating dedicated machine sets</h1>
<h1 id="_creating_dedicated_machine_sets" class="sect0"><a class="anchor" href="#_creating_dedicated_machine_sets"></a>Creating Dedicated Machine Sets</h1>
<div class="paragraph">
<p>This section guides you through the process of creating dedicated machine sets in Azure Red Hat OpenShift (ARO). Dedicated machine sets allow you to provision nodes with specific characteristics, such as different VM sizes, labels, or the use of Azure Spot Virtual Machines, to optimize resource utilization and cost for particular workloads.</p>
</div>
<div class="sect1">
<h2 id="_understanding_aro_machine_sets"><a class="anchor" href="#_understanding_aro_machine_sets"></a>Understanding ARO Machine Sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Azure Red Hat OpenShift leverages MachineSets to manage the worker nodes in your cluster. A MachineSet is a Kubernetes object that defines a group of machines (VMs) with identical configurations. It ensures that a specified number of machines matching a template are running at any given time.</p>
</div>
<div class="paragraph">
<p>By default, an ARO cluster comes with several MachineSets, typically three, each managing worker nodes in a different availability zone (if applicable). These default MachineSets provision general-purpose virtual machines.</p>
</div>
<div class="paragraph">
<p>Creating <strong>dedicated</strong> machine sets allows administrators to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Tailor Resources:</strong> Provision nodes with specific VM sizes, CPU architectures, or GPU capabilities for specialized workloads (e.g., AI/ML, high-performance computing).</p>
</li>
<li>
<p><strong>Optimize Costs:</strong> Utilize Azure Spot Virtual Machines for fault-tolerant workloads, significantly reducing compute costs.</p>
</li>
<li>
<p><strong>Isolate Workloads:</strong> Apply specific labels or taints to nodes within a dedicated machine set, allowing you to schedule pods exclusively to these nodes or prevent certain pods from running on them.</p>
</li>
<li>
<p><strong>Manage Scaling Independently:</strong> Scale specific types of worker nodes up or down based on the demand of the workloads running on them, without affecting other parts of the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These dedicated machine sets operate alongside your default worker MachineSets, providing flexibility in managing your cluster&#8217;s compute capacity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_creating_a_dedicated_spot_instance_machine_set"><a class="anchor" href="#_hands_on_activity_creating_a_dedicated_spot_instance_machine_set"></a>Hands-on Activity: Creating a Dedicated Spot Instance Machine Set</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This activity demonstrates how to create a dedicated machine set that utilizes Azure Spot Virtual Machines. Spot VMs are a cost-effective option for workloads that can tolerate interruptions, as they leverage unused Azure capacity.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Ensure you have the <code>oc</code> OpenShift CLI and <code>az</code> Azure CLI installed and configured to connect to your ARO cluster and Azure subscription, respectively.</p>
</li>
<li>
<p>You must have <code>cluster-admin</code> privileges on the ARO cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_examine_an_existing_machineset"><a class="anchor" href="#_step_1_examine_an_existing_machineset"></a>Step 1: Examine an Existing MachineSet</h3>
<div class="paragraph">
<p>To create a new machine set, it&#8217;s best practice to base it on an existing one. This ensures you capture all the necessary ARO-specific configurations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List the existing machine sets in your cluster:
&#8230;&#8203;.
oc get machineset -n openshift-machine-api
&#8230;&#8203;.</p>
<div class="literalblock">
<div class="content">
<pre>.Sample Output
....
NAME                                     DESIRED   CURRENT   READY   AVAILABLE   AGE
aro-cluster-5t2dj-worker-eastus1         1         1         1       1           3d1h
aro-cluster-5t2dj-worker-eastus2         1         1         1       1           3d1h
aro-cluster-5t2dj-worker-eastus3         1         1         1       1           3d1h
....</pre>
</div>
</div>
</li>
<li>
<p>Choose one of the worker machine sets (e.g., <code>aro-cluster-5t2dj-worker-eastus1</code>) and export its definition to a YAML file. Replace <code>&lt;EXISTING_MACHINESET_NAME&gt;</code> with the name of one of your existing machine sets.
&#8230;&#8203;.
oc get machineset &lt;EXISTING_MACHINESET_NAME&gt; -n openshift-machine-api -o yaml &gt; spotmachineset-template.yaml
&#8230;&#8203;.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_modify_the_machineset_definition_for_spot_instances"><a class="anchor" href="#_step_2_modify_the_machineset_definition_for_spot_instances"></a>Step 2: Modify the MachineSet Definition for Spot Instances</h3>
<div class="paragraph">
<p>Now, you will edit the <code>spotmachineset-template.yaml</code> file to create a new dedicated machine set that uses Azure Spot instances.</p>
</div>
<div class="paragraph">
<p>Open <code>spotmachineset-template.yaml</code> in your preferred text editor and make the following changes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Change <code>metadata.name</code></strong>: Assign a unique name to your new machine set. For example, change <code>aro-cluster-5t2dj-worker-eastus1</code> to <code>aro-cluster-5t2dj-spot-eastus1</code>.</p>
</li>
<li>
<p><strong>Update <code>spec.selector.matchLabels</code></strong>: Modify the <code>machine.openshift.io/cluster-api-machineset</code> label to match the new name you assigned in <code>metadata.name</code>.</p>
</li>
<li>
<p><strong>Update <code>spec.template.metadata.labels</code></strong>: Modify the <code>machine.openshift.io/cluster-api-machineset</code> label to match the new name. You might also want to add an additional label, such as <code>node-role.kubernetes.io/spot=</code>, to easily identify these nodes.</p>
</li>
<li>
<p><strong>Add <code>spotVMOptions</code></strong>: Within <code>spec.template.spec.providerSpec.value</code>, add the <code>spotVMOptions</code> field and set its value to an empty object <code>{}</code>. This is the crucial step that configures the machine set to use Azure Spot Virtual Machines.</p>
<div class="literalblock">
<div class="content">
<pre>[NOTE]
You might also consider changing `spec.replicas` from `1` to `0` initially if you want to apply the file without immediately provisioning a node, or set it to your desired initial replica count.</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an abridged example highlighting the key changes for a Spot MachineSet. Remember to adapt the full YAML from your exported template.</p>
</div>
<div class="literalblock">
<div class="title">spotmachineset.yaml (Abridged Example with Key Changes)</div>
<div class="content">
<pre>apiVersion: machine.openshift.io/v1beta1
kind: MachineSet
metadata:
  creationTimestamp: null
  name: aro-cluster-5t2dj-spot-eastus1 <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: openshift-machine-api
spec:
  replicas: 1
  selector:
    matchLabels:
      machine.openshift.io/cluster-api-machineset: aro-cluster-5t2dj-spot-eastus1 <i class="conum" data-value="2"></i><b>(2)</b>
  template:
    metadata:
      creationTimestamp: null
      labels:
        machine.openshift.io/cluster-api-cluster: aro-cluster-5t2dj
        machine.openshift.io/cluster-api-machine: aro-cluster-5t2dj-spot-eastus1
        machine.openshift.io/cluster-api-machineset: aro-cluster-5t2dj-spot-eastus1 <i class="conum" data-value="3"></i><b>(3)</b>
        node-role.kubernetes.io/worker: ""
        node-role.kubernetes.io/spot: "" <i class="conum" data-value="4"></i><b>(4)</b>
    spec:
      providerSpec:
        value:
          apiVersion: azureprovider.openshift.io/v1beta1
          cloudProviderSource: OpenShiftManaged
          credentialsSecret:
            name: azure-cloud-credentials
          image:
            offer: aro-rhel8
            publisher: redhat
            sku: aro_416_gen2
            version: 416.86.202307251756-0 <i class="conum" data-value="5"></i><b>(5)</b>
          internalLoadBalancer: ""
          kind: AzureMachineProviderSpec
          location: eastus <i class="conum" data-value="6"></i><b>(6)</b>
          managedIdentity: aro-cluster-5t2dj-identity
          natRule: 0
          networkResourceGroup: aro-cluster-5t2dj-rg
          osDisk:
            diskSizeGB: 128
            managedDisk:
              storageAccountType: Premium_LRS
            osType: Linux
          publicIP: false
          resourceGroup: aro-cluster-5t2dj-rg
          spotVMOptions: {} <i class="conum" data-value="7"></i><b>(7)</b>
          sshPrivateKey: ""
          sshPublicKey: ""
          subnet: aro-cluster-5t2dj-worker-subnet
          userDataSecret:
            name: worker-user-data
          vmSize: Standard_D4s_v3 <i class="conum" data-value="8"></i><b>(8)</b>
          vnet: aro-cluster-5t2dj-vnet
          zone: "1" <i class="conum" data-value="9"></i><b>(9)</b>
      taints:
        - effect: NoSchedule
          key: spot-instance
          value: "true" <i class="conum" data-value="10"></i><b>(10)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>New, unique name for the dedicated MachineSet.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Update this selector label to match the new name.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Update this template label to match the new name.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><strong>Optional:</strong> Add a specific label to identify spot nodes. You can use this for node selectors in your Pods.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the <code>image.version</code> is current for your cluster&#8217;s OpenShift version. You might need to update this.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Ensure <code>location</code> matches your Azure region.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>This crucial field enables Azure Spot Virtual Machines for this MachineSet.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><strong>Optional:</strong> Change <code>vmSize</code> if you need different compute capabilities for your dedicated nodes.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><strong>Optional:</strong> Change <code>zone</code> to <code>2</code> or <code>3</code> to deploy nodes in a different availability zone if desired, or remove it to allow Azure to pick. If removing it, ensure your MachineSet name doesn&#8217;t imply a specific zone.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td><strong>Optional:</strong> Add a <code>NoSchedule</code> taint to prevent pods from scheduling on these nodes unless they explicitly tolerate the taint. This is useful for preventing non-spot-tolerant workloads from landing on these interruptible nodes.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save the modified file as <code>spotmachineset.yaml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_create_the_new_machineset"><a class="anchor" href="#_step_3_create_the_new_machineset"></a>Step 3: Create the New MachineSet</h3>
<div class="paragraph">
<p>Apply the modified YAML file to your cluster to create the dedicated machine set.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc create -f spotmachineset.yaml</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>machineset.machine.openshift.io/aro-cluster-5t2dj-spot-eastus1 created</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_verify_the_creation_and_status"><a class="anchor" href="#_step_4_verify_the_creation_and_status"></a>Step 4: Verify the Creation and Status</h3>
<div class="paragraph">
<p>Verify that the new machine set has been created and that the desired number of machines are provisioning or running.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc get machineset -n openshift-machine-api</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>NAME                                     DESIRED   CURRENT   READY   AVAILABLE   AGE
aro-cluster-5t2dj-worker-eastus1         1         1         1       1           3d1h
aro-cluster-5t2dj-worker-eastus2         1         1         1       1           3d1h
aro-cluster-5t2dj-worker-eastus3         1         1         1       1           3d1h
aro-cluster-5t2dj-spot-eastus1           1         1         1       1           2m</pre>
</div>
</div>
<div class="paragraph">
<p>You can also list the nodes to confirm the new spot instance node has joined the cluster and has the expected labels (if you added any).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc get nodes -l node-role.kubernetes.io/spot=</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Sample Output (if <code>node-role.kubernetes.io/spot</code> label was added)</div>
<div class="content">
<pre>NAME                                         STATUS   ROLES                         AGE   VERSION
aro-cluster-5t2dj-spot-eastus1-xxxx-yyyy     Ready    worker,spot                   2m    v1.26.10+d7606e1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_scaling_your_dedicated_machine_set"><a class="anchor" href="#_step_5_scaling_your_dedicated_machine_set"></a>Step 5: Scaling Your Dedicated Machine Set</h3>
<div class="paragraph">
<p>You can scale your dedicated machine set up or down like any other machine set to adjust the number of dedicated nodes.</p>
</div>
<div class="paragraph">
<p>To scale the <code>aro-cluster-5t2dj-spot-eastus1</code> machine set to 2 replicas:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc scale machineset aro-cluster-5t2dj-spot-eastus1 --replicas=2 -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>This completes the creation of a dedicated machine set using Azure Spot Virtual Machines. You can now configure your applications to target these nodes using node selectors or tolerations based on the labels or taints you added.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configuring-additional-storage-classes.html">Configuring additional storage classes</a></span>
  <span class="next"><a href="configuring-node-autoscaling.html">Configuring node autoscaling</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
