<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure network policies and limit ingress traffic :: Advanced Administration of Azure Red Hat OpenShift</title>
    <link rel="prev" href="externalize-application-configurations.html">
    <link rel="next" href="implement-gitops-for-cluster-administration.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Advanced Administration of Azure Red Hat OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="wurcbtest" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/azure-red-hat-openshift-architecture-and-overview.html">Azure Red Hat OpenShift Architecture and Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/aro-platform-capabilities.html">ARO platform capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/joint-engineering-operation-and-support-model.html">Joint engineering, operation, and support model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../azure-red-hat-openshift-architecture-and-overview/managed-control-plane-and-infrastructure.html">Managed control plane and infrastructure</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../aro-cluster-provisioning/aro-cluster-provisioning.html">ARO Cluster Provisioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-an-azure-red-hat-openshift-cluster.html">Creating an Azure Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../aro-cluster-provisioning/creating-a-private-azure-red-hat-openshift-cluster.html">Creating a private Azure Red Hat OpenShift cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core-cluster-configuration/core-cluster-configuration.html">Core Cluster Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-cluster-configuration/configuring-additional-storage-classes.html">Configuring additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-cluster-configuration/creating-dedicated-machine-sets.html">Creating dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-cluster-configuration/configuring-node-autoscaling.html">Configuring node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-cluster-configuration/configuring-log-forwarding.html">Configuring log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-cluster-configuration/configuring-custom-dns-and-dns-forwarding.html">Configuring custom DNS and DNS forwarding</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registry-integrations/registry-integrations.html">Registry Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-azure-container-registry-acr.html">Integrating with Azure Container Registry (ACR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/integrating-with-quay.html">Integrating with Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registry-integrations/using-the-internal-openshift-registry.html">Using the internal OpenShift registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-application-data-management/cluster-application-data-management.html">Cluster Application Data Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-application-data-management/backup-and-restore-of-cluster-applications-using-velero.html">Backup and restore of cluster applications using Velero</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/openshift-and-kubernetes-interfaces.html">OpenShift and Kubernetes Interfaces</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/navigating-the-openshift-web-console.html">Navigating the OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-kubernetes-command-line-interface-cli.html">Utilizing the Kubernetes Command-line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift-and-kubernetes-interfaces/utilizing-the-openshift-command-line-interface-cli.html">Utilizing the OpenShift Command-line Interface (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-and-application-management.html">Troubleshooting and Application Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/troubleshooting-containers-and-pods.html">Troubleshooting containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-and-application-management/managing-applications-using-the-kubernetes-workload-api.html">Managing applications using the Kubernetes Workload API</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/kubernetes-networking-and-application-exposure.html">Kubernetes Networking and Application Exposure</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/understanding-kubernetes-pod-and-service-networks.html">Understanding Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/scaling-and-exposing-applications-to-external-access.html">Scaling and exposing applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes-networking-and-application-exposure/externalizing-application-configurations.html">Externalizing application configurations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-security-policies/network-security-policies.html">Network Security Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/configuring-network-policies.html">Configuring network policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-security-policies/limiting-ingress-traffic.html">Limiting ingress traffic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gitops-for-cluster-administration/gitops-for-cluster-administration.html">GitOps for Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/implementing-openshift-gitops.html">Implementing OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gitops-for-cluster-administration/using-argocd-for-declarative-cluster-management.html">Using ArgoCD for declarative cluster management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../multi-cluster-management/multi-cluster-management.html">Multi-Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/overview-of-red-hat-advanced-cluster-management-rhacm.html">Overview of Red Hat Advanced Cluster Management (RHACM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../multi-cluster-management/managing-kubernetes-clusters-with-rhacm.html">Managing Kubernetes clusters with RHACM</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../knowledge-share-and-discussions/knowledge-share-and-discussions.html">Knowledge Share and Discussions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-ad-with-openshift-oauth.html">Integrating Azure AD with OpenShift OAuth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/integrating-azure-key-vault-with-aro.html">Integrating Azure Key Vault with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/differentiating-availability-sets-vs-availability-zones.html">Differentiating Availability Sets vs. Availability Zones</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/understanding-azure-spot-instances.html">Understanding Azure Spot Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../knowledge-share-and-discussions/exploring-hosted-control-planes.html">Exploring Hosted Control Planes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-an-azure-red-hat-openshift-cluster.html">Create an Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-additional-storage-classes.html">Configure additional storage classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-dedicated-machine-sets.html">Create dedicated machine sets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-node-autoscaling.html">Configure node autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-log-forwarding.html">Configure log forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-a-private-azure-red-hat-openshift-cluster.html">Create a private Azure Red Hat OpenShift Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-custom-dns-and-dns-forwarding.html">Configure custom DNS and DNS forwarding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implement-registry-integrations-with-aro.html">Implement registry integrations with ARO</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="perform-backup-and-restore-of-a-cluster-application-with-velero.html">Perform backup and restore of a cluster application with Velero</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshoot-containers-and-pods.html">Troubleshoot containers and pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="manage-applications-using-the-kubernetes-workload-api.html">Manage applications using the Kubernetes Workload API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="explore-kubernetes-pod-and-service-networks.html">Explore Kubernetes Pod and Service Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scale-and-expose-applications-to-external-access.html">Scale and expose applications to external access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="externalize-application-configurations.html">Externalize application configurations</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="manage-a-cluster-using-red-hat-advanced-cluster-management.html">Manage a cluster using Red Hat Advanced Cluster Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Advanced Administration of Azure Red Hat OpenShift</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Advanced Administration of Azure Red Hat OpenShift</a></li>
    <li><a href="hands-on-lab.html">Hands-on Lab</a></li>
    <li><a href="configure-network-policies-and-limit-ingress-traffic.html">Configure network policies and limit ingress traffic</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure network policies and limit ingress traffic</h1>
<h1 id="_configure_network_policies_and_limit_ingress_traffic" class="sect0"><a class="anchor" href="#_configure_network_policies_and_limit_ingress_traffic"></a>Configure Network Policies and Limit Ingress Traffic</h1>
<div class="paragraph">
<p>Understanding and implementing robust network policies is crucial for securing applications and controlling traffic flow within your Azure Red Hat OpenShift (ARO) clusters. ARO leverages OpenShift&#8217;s Software Defined Networking (SDN) capabilities, built upon OVN-Kubernetes, to provide granular control over network communication for pods, projects, and external access.</p>
</div>
<div class="sect1">
<h2 id="_overview_of_network_policies_in_aro"><a class="anchor" href="#_overview_of_network_policies_in_aro"></a>Overview of Network Policies in ARO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Azure Red Hat OpenShift, network policies are fundamental to controlling how applications communicate with each other and with external services. They allow administrators to define rules that govern inbound (ingress) and outbound (egress) traffic at the pod level, enhancing security and isolating workloads.</p>
</div>
<div class="paragraph">
<p>The underlying network plugin for ARO is OVN-Kubernetes, which integrates seamlessly with Kubernetes <code>NetworkPolicy</code> objects. This allows for comprehensive control over network traffic down to individual pods, even within the same cluster or namespace.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title"><code>OpenShift SDN and NetworkPolicy Control</code></div>
<div class="paragraph">
<p>OpenShift Software Defined Networking (SDN) configures an overlay network using Open vSwitch (OVS), an OpenFlow implementation based on Container Network Interface (CNI). This enables features like <code>NetworkPolicy</code> objects for defining ingress and egress rules. The <code>ovs-networkpolicy</code> plugin enforces these rules.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ingress_network_policies"><a class="anchor" href="#_ingress_network_policies"></a>Ingress Network Policies</h3>
<div class="paragraph">
<p>Ingress network policies in ARO are supported as part of OpenShift SDN and are enabled by default. They are designed to control inbound connections to pods. You, as the cluster administrator or project administrator, are responsible for defining and enforcing these policies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>V1 NetworkPolicy Compliance</strong>: OpenShift&#8217;s ingress network policies are fully compliant with Kubernetes V1 <code>NetworkPolicy</code> specifications. This allows you to define standard rules based on pod selectors, namespace selectors, and IP blocks.</p>
</li>
<li>
<p><strong>Granular Control</strong>: You can apply policies that restrict traffic between pods on the same cluster, and even within the same namespace, providing fine-grained security.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title"><code>Ingress Policy Limitations</code></div>
<div class="paragraph">
<p>While ingress network policies are V1 <code>NetworkPolicy</code> compliant, certain <code>Egress</code> and <code>IPBlock</code> types <strong>within an ingress policy definition</strong> might behave differently or have limitations compared to other Kubernetes environments. For managing outbound traffic, OpenShift provides dedicated <code>EgressNetworkPolicy</code> objects.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_egress_network_policies"><a class="anchor" href="#_egress_network_policies"></a>Egress Network Policies</h3>
<div class="paragraph">
<p>Beyond ingress control, ARO also provides mechanisms to manage outbound traffic from pods using <code>EgressNetworkPolicy</code> objects, which leverage OpenShift&#8217;s egress firewall feature. Egress policies are critical for preventing data exfiltration or limiting application access to external resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Purpose</strong>: These policies prevent or limit outbound traffic, allowing you to define which external destinations a pod or namespace can connect to.</p>
</li>
<li>
<p><strong>Scope</strong>: There is typically only one egress policy per namespace/project.</p>
</li>
<li>
<p><strong>Evaluation Order</strong>: Egress policies are evaluated in order (first to last).</p>
</li>
<li>
<p><strong>Limitations</strong>: Egress policies are <strong>not supported</strong> on the <code>default</code> namespace. Also, currently, all virtual machines within ARO must have outbound internet access, which is a consideration for the underlying infrastructure, not necessarily the pod-level egress policy itself.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_limiting_ingress_traffic"><a class="anchor" href="#_limiting_ingress_traffic"></a>Limiting Ingress Traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Limiting ingress traffic to your applications in ARO involves using <code>NetworkPolicy</code> objects as the primary mechanism. Additionally, route annotations offer a way to control traffic at the OpenShift Route level for specific ingress points.</p>
</div>
<div class="sect2">
<h3 id="_using_networkpolicy_objects_for_ingress_control"><a class="anchor" href="#_using_networkpolicy_objects_for_ingress_control"></a>Using NetworkPolicy Objects for Ingress Control</h3>
<div class="paragraph">
<p>The most robust way to limit ingress traffic to pods is by creating <code>NetworkPolicy</code> objects. These policies specify how a group of pods is allowed to communicate with other pod groups or network endpoints.</p>
</div>
<div class="paragraph">
<p>By default, in OpenShift, if no <code>NetworkPolicy</code> is applied to a pod, it can accept traffic from all sources within the cluster. Applying a <code>NetworkPolicy</code> immediately isolates the pod, denying all traffic not explicitly permitted by the policy.</p>
</div>
<div class="paragraph">
<p>The cluster ingress traffic always traverses the defined load balancer, which then forwards it to the OpenShift IngressController, and finally to your application pods via services. <code>NetworkPolicy</code> objects act <strong>after</strong> the IngressController routes the traffic to the target service/pod.</p>
</div>
</div>
<div class="sect2">
<h3 id="_route_annotations_for_ip_allow_lists"><a class="anchor" href="#_route_annotations_for_ip_allow_lists"></a>Route Annotations for IP Allow Lists</h3>
<div class="paragraph">
<p>For ingress control at the OpenShift Route level, project administrators can add specific route annotations. One common use case is implementing an IP allow list, which restricts access to an application exposed via a route to only specific source IP addresses. This provides an additional layer of security before traffic even reaches the application pod.</p>
</div>
<div class="paragraph">
<p>For example, an annotation like <code>haproxy.router.openshift.io/ip_whitelist: "192.168.1.0/24 10.0.0.1"</code> can be added to a route to allow traffic only from the specified IP ranges.</p>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_the_ingress_path"><a class="anchor" href="#_understanding_the_ingress_path"></a>Understanding the Ingress Path</h3>
<div class="paragraph">
<p>Recall that all cluster ingress traffic traverses the defined load balancer. ARO automatically sets up public cloud load balancers and configures the OpenShift Ingress cluster operator and the default <code>IngressController</code>. You can also add additional customer-managed <code>IngressControllers</code> and set the default <code>IngressController</code> as private. <code>NetworkPolicy</code> objects then provide granular control over this traffic once it enters the cluster network and targets your application pods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_configuring_network_policies_to_limit_ingress_traffic"><a class="anchor" href="#_hands_on_activity_configuring_network_policies_to_limit_ingress_traffic"></a>Hands-on Activity: Configuring Network Policies to Limit Ingress Traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you will deploy a simple Nginx application, expose it via an OpenShift Route, and then create a <code>NetworkPolicy</code> to restrict ingress access to it.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>An active Azure Red Hat OpenShift cluster.</p>
</li>
<li>
<p><code>oc</code> CLI tool configured and logged into your cluster with administrative privileges.</p>
</li>
<li>
<p><code>kubectl</code> CLI tool installed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_create_a_new_project_and_deploy_a_sample_application"><a class="anchor" href="#_step_1_create_a_new_project_and_deploy_a_sample_application"></a>Step 1: Create a New Project and Deploy a Sample Application</h3>
<div class="paragraph">
<p>First, create a dedicated project for this lab and deploy a basic Nginx application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a new project</strong>:
<code><code>bash
oc new-project network-policy-lab
</code></code>
This command switches your context to the new <code>network-policy-lab</code> project.</p>
</li>
<li>
<p><strong>Deploy the Nginx application</strong>:
Create a <code>Deployment</code> and <code>Service</code> for Nginx.</p>
<div class="literalblock">
<div class="content">
<pre>[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx
  labels:
    app: my-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-nginx
  template:
    metadata:
      labels:
        app: my-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: my-nginx-service
spec:
  selector:
    app: my-nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Save this content as `nginx-app.yaml` and apply it:
```bash
oc apply -f nginx-app.yaml
```</pre>
</div>
</div>
</li>
<li>
<p><strong>Expose the Nginx application using a Route</strong>:
<code><code>bash
oc expose service my-nginx-service
</code></code></p>
</li>
<li>
<p><strong>Verify the application and access it</strong>:
Get the route URL:
<code><code>bash
oc get route my-nginx-service -o jsonpath='{.spec.host}'
</code></code>
Open the URL in your web browser. You should see the Nginx welcome page. Alternatively, use <code>curl</code>:
<code><code>bash
curl $(oc get route my-nginx-service -o jsonpath='{.spec.host}')
</code></code>
You should receive an HTML response from Nginx.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_a_network_policy_to_deny_all_ingress"><a class="anchor" href="#_step_2_create_a_network_policy_to_deny_all_ingress"></a>Step 2: Create a Network Policy to Deny All Ingress</h3>
<div class="paragraph">
<p>Now, you will create a <code>NetworkPolicy</code> that isolates the <code>my-nginx</code> pod, denying all ingress traffic not explicitly allowed. Since this policy won&#8217;t allow <strong>any</strong> traffic initially, it will effectively block access to Nginx.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Define the NetworkPolicy</strong>:
Create a file named <code>deny-all-ingress.yaml</code> with the following content:</p>
<div class="literalblock">
<div class="content">
<pre>[source,yaml]
----
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all-ingress
  namespace: network-policy-lab
spec:
  podSelector:
    matchLabels:
      app: my-nginx
  policyTypes:
    - Ingress
  ingress: [] # An empty ingress list denies all ingress traffic
----</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>podSelector</code>: This targets any pod with the label <code>app: my-nginx</code>.</p>
</li>
<li>
<p><code>policyTypes: - Ingress</code>: Specifies that this policy applies to ingress traffic.</p>
</li>
<li>
<p><code>ingress: []</code>: An empty list under <code>ingress</code> means "allow no ingress traffic". If this section was omitted, the <code>podSelector</code> alone would isolate the pod.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Apply the NetworkPolicy</strong>:
<code><code>bash
oc apply -f deny-all-ingress.yaml
</code></code></p>
</li>
<li>
<p><strong>Verify access is denied</strong>:
Try accessing the Nginx application again using the route URL or <code>curl</code>:
<code><code>bash
curl $(oc get route my-nginx-service -o jsonpath='{.spec.host}')
</code></code>
You should now see a connection timeout or a connection refused error, indicating that the <code>NetworkPolicy</code> is blocking traffic to the Nginx pod.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_modify_network_policy_to_allow_specific_ingress_optional"><a class="anchor" href="#_step_3_modify_network_policy_to_allow_specific_ingress_optional"></a>Step 3: Modify Network Policy to Allow Specific Ingress (Optional)</h3>
<div class="paragraph">
<p>To demonstrate how to selectively allow ingress, let&#8217;s create a second Nginx instance and configure the policy to allow traffic <strong>only</strong> from pods within the same namespace that have a specific label.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Deploy a "client" Nginx application in the same namespace</strong>:
This Nginx will act as a client trying to access <code>my-nginx</code>.
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-client-nginx
  labels:
    app: client-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: client-nginx
  template:
    metadata:
      labels:
        app: client-nginx
    spec:
      containers:</p>
<div class="ulist">
<ul>
<li>
<p>name: nginx
image: nginx:latest
ports:</p>
</li>
<li>
<p>containerPort: 80
----
Save as <code>client-nginx.yaml</code> and apply:
<code><code>bash
oc apply -f client-nginx.yaml
</code></code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Modify the <code>NetworkPolicy</code> to allow ingress from <code>client-nginx</code></strong>:
Edit <code>deny-all-ingress.yaml</code> to <code>allow-from-client.yaml</code> to permit traffic from pods with <code>app: client-nginx</code> label within the same namespace.</p>
<div class="literalblock">
<div class="content">
<pre>[source,yaml]
----
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-client
  namespace: network-policy-lab
spec:
  podSelector:
    matchLabels:
      app: my-nginx
  policyTypes:
    - Ingress
  ingress:
    - from:
      - podSelector:
          matchLabels:
            app: client-nginx
----</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This policy still isolates <code>my-nginx</code> but now explicitly allows ingress <code>from</code> any pod in the <strong>same namespace</strong> (<code>network-policy-lab</code>) that has the label <code>app: client-nginx</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Apply the modified NetworkPolicy</strong>:
First, delete the old policy (or just apply the new one with a different name). Let&#8217;s delete and re-create for clarity.
<code><code>bash
oc delete networkpolicy deny-all-ingress
oc apply -f allow-from-client.yaml
</code></code></p>
</li>
<li>
<p><strong>Test connectivity from the client pod</strong>:
Execute a <code>curl</code> command <strong>from</strong> the <code>my-client-nginx</code> pod to the <code>my-nginx-service</code>.
<code><code>bash
CLIENT_POD=$(oc get pod -l app=client-nginx -o jsonpath='{.items[0].metadata.name}')
oc exec -it $CLIENT_POD&#8201;&#8212;&#8201;curl my-nginx-service.network-policy-lab.svc.cluster.local
</code></code>
You should now see the Nginx welcome page HTML response, confirming that the client pod can access <code>my-nginx-service</code> due to the <code>NetworkPolicy</code>.</p>
</li>
<li>
<p><strong>Verify external access is <strong>still</strong> denied</strong>:
Try accessing <code>my-nginx</code> from your local machine via the Route URL again.
<code><code>bash
curl $(oc get route my-nginx-service -o jsonpath='{.spec.host}')
</code></code>
This external access should <strong>still</strong> be denied because the <code>NetworkPolicy</code> only allowed ingress from specific pods <strong>within</strong> the cluster, not from external sources via the Route.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup"><a class="anchor" href="#_cleanup"></a>Cleanup</h3>
<div class="paragraph">
<p>When you are finished with this lab, clean up the resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete project network-policy-lab</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will delete the project and all resources within it, including deployments, services, routes, and network policies.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="externalize-application-configurations.html">Externalize application configurations</a></span>
  <span class="next"><a href="implement-gitops-for-cluster-administration.html">Implement GitOps for cluster administration</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
